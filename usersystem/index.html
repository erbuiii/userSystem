<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<title>用户管理系统</title>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="lib/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="lib/bootstrap-table-develop/src/bootstrap-table.css">
	<link rel="stylesheet" type="text/css" href="global.css?v=2018042601">
	<link rel="stylesheet" type="text/css" href="iconfont/iconfont.css">
	<script type="text/javascript" src="lib/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="lib/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="lib/bootstrap-table-develop/src/bootstrap-table.js"></script>
	<!-- <script type="text/javascript" src="scripts/index.js"></script> -->
</head>
<body>
	<div class="wrapper">
		<div class="top-nav-wrap">
			<div class="top-nav">
				<div class="logo-box"></div>
				<div class="user-operate">
					<ul>
						<li class="avatar-box">
							<a href="#"  class="avatar"></a>
						</li>
						<li class="username">
							<span>username</span>
						</li>
						<li>
							<a href="#"  class="sign-out"></a>
						</li>
					</ul>
				</div>
			</div>
		</div>


		<div class="main-wrap">
			<div class="main-con">
				<div class="left-wrap">
					<ul class="menu">
						<li class="menu-item">
							<span class="iconfont icon-yonghu"></span>
							<a href="#">用户管理</a>
						</li>
						<li class="menu-item select">
							<span class="iconfont icon-quanxian"></span>
							<a href="#">用户管理</a>
						</li>
						<li class="menu-item">
							<span class="iconfont icon-tongji"></span>
							<a href="#">用户管理</a>
						</li>
						<li class="menu-item">
							<span class="iconfont icon-zhanghugaikuang"></span>
							<a href="#">用户管理</a>
						</li>
						<li class="menu-item">
							<span class="iconfont icon-baobiao"></span>
							<a href="#">用户管理</a>
						</li>
						<li class="menu-item">
							<span class="iconfont icon-zhanghu"></span>
							<a href="#">用户管理</a>
						</li>
					</ul>
				</div>
				<div class="right-wrap">
					<div class="right-header">
						<ul class="right-nav">
							<li>
								<a href="#">主页</a> / 
							</li>
							<li>
								<span>用户管理</span>
							</li>
						</ul>
					</div>
					<div class="right-con">
						<div class="filter-wrap">
							<ul class="query-opts">
								<li class="zh-q">
									<a href="#" class="select">综合查询</a>
								</li>
								<li class="custom-q">
									<a href="#">自定义查询</a>
								</li>
							</ul>
							<ul class="search-wrap">
								<li class="search-box">
									<form action="post">
										<input id="search-text" type="text" name="search-con" class="search-input">
										<i id="search-btn" class="iconfont icon-sousuo"></i>
									</form>
								</li>
								<li class="add">
									<i class="iconfont icon-tianjia"></i>
									<a href="#">添加</a>
								</li>
							</ul>
						</div>
						<div class="table-wrap">
							<div id="toolbar">
								<button id="insert" class="btn btn-primary">
									<i id="search-btn" class="glyphicon "></i>添加
								</button>
								<button id="remove" class="btn btn-primary">
									<i class="glyphicon glyphicon-remove"></i>删除
								</button>
							</div>
							<table id="tb_user"></table>
						</div>
						<script type="text/javascript">
							var $table = $('#tb_user'),
								$remove = $('#remove');

							$table.bootstrapTable({
								// ajax: function (request) {
								// 	$.ajax({
								// 		type: "POST",
								// 		url:"http://222.31.67.167:82/api/Admin",
								// 		// contentType: "application/json;charset=utf-8",
								// 		// dataType: "jsonp",
								// 		// jsonp: 'callback',
								// 		data: {
								// 			username: 'hcy',
								// 			password: 'hhh'
								// 		},
										
								// 		success: function(msg) {
								// 			request.success({
								// 				row: msg
								// 			});
								// 			$table.bootstrapTable('load',msg);
								// 		},
								// 		error: function(){
								// 			alert("请求失败");
								// 		}
								// 	});
								// },
								url:"http://222.31.67.167:82/api/Admin",
								method: 'post',
								// contentType : "application/x-www-form-urlencoded",
								cache: false,  //设置为false，禁用ajax数据缓存，默认为true
								striped: true,  //表格显示条纹
								pagination: true,  //启动分页
								sidePagination: 'server',  //服务器端分页
								sortable: false,  //设置为false，禁用所有列的排序
								sortOrder: 'desc',  //排序方式
								pageSize: 15,  //每页显示的记录数
								pageNumber: 1,  //当前显示第几页
								pageList: [5, 10, 15, 20, 25],  //记录数可选列表
								// queryParams: function queryParams(params){
								// 	var params = {
								// 		pageSize : params.pageSize,
								// 		pageIndex : params.Number,
								// 		textSearch: $("#search-text").val(),
								// 		username: 'hcy',
								// 		password: 'hhh'
								// 	}
								// 	return params;
								// },
								queryParamsType:'',  //默认为空时传递：sortOrder,pageSize,pageNumber
								search: false,  //是否启用搜索框
								strictsearch: true,  //模糊或严格搜索
								showColumns: true,  //是否显示所有的列（选择显示的列）
								showRefresh: true,  //是否显示刷新按钮
								minimumCountColumns: 2,  //最少允许的列数
								clickToSelect: true,  //是否启用点击选中行
								height: 500,  //行高，如果没有设置height属性，表格自动根据记录条数决定高度
								// idField: 'id',
								idField: 'user_name',  //指定主键列
								uniqleId: 'user_id',  //每行的唯一标识，一般为主键列

								columns: [
									{
										field: 'state',
										checkbox: true,
										align: 'center',
									}, {
										title: '用户名',
										field: 'user_name',
										align: 'center',
										valign: 'middle',
									}, {
										title: '性别',
										field: 'user_sex',
										align: 'center',
										valign: 'middle',
									}, {
										title: '年级',
										field: 'user_grade',
										align: 'center',
										valign: 'middle',
									}, {
										title: '学部',
										field: 'user_xuebu',
										align: 'center',
										valign: 'middle',
									}, {
										title: '学院',
										field: 'user_xueyuan',
										align: 'center',
										valign: 'middle',
									}, {
										title: '专业',
										field: 'user_profession',
										align: 'center',
										valign: 'middle',
									}, {
										title: '操作',
										field: 'user_edit',
										align: 'center',
										valign: 'middle',
										formatter: operateFormatter
										// events: operateEvents
									}, 
								],
								onLoadSuccess: function(){
									console.info("加载成功");
								},
								onLoadError: function(){
									console.info("加载数据失败");
								},
								// onDbClickRow: function(row, $element) {
								// 	var id = row.ID;
								// 	EditViewById(id, 'view');
								// }
							});
							
							// //操作栏的格式化

							function operateFormatter(value, row, index) {
								var id = value;
								var result = "";
								result += "<a href='javascript:;' class='btn btn-xs' onclick=\"EditViewById('" + id + "', view='view')\" title='编辑'><i class='glyphicon glyphicon-pencil'></i></a>";
								result += "<a href='javascript:;' class='btn btn-xs' onclick=\"DeleteByIds('" + id + "', view='view')\" title='删除'><i class='glyphicon glyphicon-remove'></i></a>";

								return result;
							}

							// 删除操作
							function deleteUser(ids) {
								var msg = "您真的确定要删除吗？";
								if (confirm(msg) == true) {
									$.ajax ({
										url: "",  //删除数据的api
										type: "POST",
										data: {
											ids: ids
										},
										success: function (data) {
											alert(data.msg);

											//重新加载数据
											$table.bootstrapTable('refresh',{url: "http://222.31.67.167:82/api/Admin"});  //加载数据的api
										}
									});
								}
							}
							// 批量删除
							$('#remove').click(function() {
								deleteUserList();
							});
							
							function deleteUserList() {
								var rows = $table.bootstrapTable('getSelections');
								if( rows.length == 0 ) {
									alert("请先选择要删除的记录！");
									return;
								}
								var ids = '';
								for (var i = 0; i < rows.length; i++) {
									ids += rows[i][user_id] + ",";
								}
								ids = ids.substring(0, ids.length-1);
								deleteUser(ids);
							}

							$('#search-btn').click(function(){
        						$table.bootstrapTable('refresh');
        						$table.bootstrapTable('refreshOptions',{pageNumber:1,pageSize:10});
    						})
							// /*function operateFormatter(index, row) {
							// 	return [
							// 		'<a href="javascript:void(0)" class="edit" title="Edit">',
							// 			'<i class="glyphicon glyphicon-pencil"></i>',
							// 		'</a>',
							// 		'<a href="javascript:void(0)" class="remove" title="Remove">',
							// 			'<i class="glyphicon glyphicon-remove"></i>',
							// 		'</a>'
							// 	].join('');
							// }

							// window.operateEvents = {
							// 	'click .remove': function (e, value, row, index) {
							// 		// $table.bootstrapTable('remove', {
							// 		// 	field: 'user_name',
							// 		// 	values: [row.user_name]
							// 		// });
							// 		$.ajax({
							// 			type: "POST",
							// 			url: "",
							// 			data: {
							// 				user_id: row['user_id']
							// 			},
							// 			dataType: 'JSON',
							// 			success: function (data) {
							// 				if ( data.result != 0 ) {
							// 					toastr.info("info", data.message);
							// 					return;
							// 				}
							// 				toastr.success("success", '删除成功');
							// 				$table.bootstrapTable('remove', {
							// 					field: 'user_id',
							// 					values: [row['user_id']]
							// 				});
							// 			}
							// 		});
							// 		return false;
							// 	},
							// };

							
							// //获取表格记录
							// var rows = $table.bootstrapTable('getSelections');
							// if (rows.length > 0) {
							// 	user_id = rows[0].user_id;
							// }

							// //多条记录删除
							// function Delete() {
							// 	var ids = "";  //得到用户选择的数据的ID
							// 	var rows = $table.bootstrapTable('getSelections');
							// 	for (var i = 0; i < rows.length; i++) {
							// 		ids += rows[i].user_id + ',';
							// 	}
							// 	ids = ids.substring(0, ids.length-1);

							// 	DeleteByIds(ids);
							// }
							

						</script>
					</div>
				</div>
			</div>
		</div>
	</div>
	
</body>
</html>